-- Library Setup
local Library = loadstring(game:HttpGet('https://raw.githubusercontent.com/bloodball/-back-ups-for-libs/main/Shaman.lua'))()
local Flags = Library.Flags

-- Game Check
if game.PlaceId ~= 189707 then
    warn("This script only works in Natural Disaster Survival.")
    return
end

-- UI Windows and Tabs
local Window = Library:Window({ Text = "Baseplate" })

local Tab = Window:Tab({ Text = "Player" })
local Tab2 = Window:Tab({ Text = "Teleport" })
local Tab3 = Window:Tab({ Text = "Universal Hub" })
local Tab4 = Window:Tab({ Text = "Settings" })
local Tab5 = Window:Tab({ Text = "Status" })

-- Sections
local Section = Tab:Section({ Text = "Human Function" })
local Section2 = Tab2:Section({ Text = "TP Selected" })
local Section3 = Tab3:Section({ Text = "Universal Scripts" })
local Section4 = Tab4:Section({ Text = "Settings Data" })
local Section5 = Tab5:Section({ Text = "Game Status" })

-- Fall Damage Toggle
local noFallEnabled = false
local noFallConnection

local function applyNoFall()
    local player = game.Players.LocalPlayer
    local z = Vector3.zero
    local rs = game:GetService("RunService")

    local function disableVelocity(char)
        local root = char:WaitForChild("HumanoidRootPart", 5)
        if root then
            noFallConnection = rs.Heartbeat:Connect(function()
                if not root.Parent or not noFallEnabled then
                    noFallConnection:Disconnect()
                    return
                end
                local vel = root.AssemblyLinearVelocity
                root.AssemblyLinearVelocity = z
                rs.RenderStepped:Wait()
                root.AssemblyLinearVelocity = vel
            end)
        end
    end

    disableVelocity(player.Character or player.CharacterAdded:Wait())
    player.CharacterAdded:Connect(function(char)
        if noFallEnabled then
            disableVelocity(char)
        end
    end)
end

local function disableNoFall()
    if noFallConnection then
        noFallConnection:Disconnect()
        noFallConnection = nil
    end
end

-- UI: No Fall Damage Toggle
Section:Toggle({
    Text = "No Fall Damage",
    Callback = function(state)
        noFallEnabled = state
        if state then
            applyNoFall()
        else
            disableNoFall()
        end
    end
})

-- UI: Teleport Buttons
Section2:Button({
    Text = "Teleport to Lobby",
    Tooltip = "Teleports you to the lobby.",
    Callback = function()
        local root = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            root.CFrame = CFrame.new(-285, 181, 352)
        end
    end
})

Section2:Button({
    Text = "Teleport to Grounds",
    Tooltip = "Teleports you to the center of the current map.",
    Callback = function()
        local root = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            root.CFrame = CFrame.new(-105.5, 44.2, -38.5, -1, 0, 0, 0, 1, 0, 0, 0, -1)
        end
    end
})

-- Universal Hub Buttons
Section3:Button({
    Text = "Load Infinite Yield",
    Tooltip = "Loads the Infinite Yield universal admin script.",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
    end
})

Section3:Button({
    Text = "Load Dex Explorer",
    Tooltip = "Loads the latest Dex Explorer tool (Moon Version).",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/peyton2465/Dex/master/out.lua"))()
    end
})

-- Settings Buttons
Section4:Toggle({
    Text = "Anti-AFK",
    Callback = function(state)
        if state then
            local vu = game:GetService("VirtualUser")
            game:GetService("Players").LocalPlayer.Idled:Connect(function()
                vu:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
                wait(1)
                vu:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            end)
        end
    end
})

Section4:Toggle({
    Text = "ESP Players",
    Callback = function(state)
        local Players = game:GetService("Players")
        local RunService = game:GetService("RunService")
        if state then
            RunService:BindToRenderStep("PlayerESP", Enum.RenderPriority.Camera.Value + 1, function()
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= Players.LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        if not player.Character:FindFirstChild("ESP") then
                            local billboard = Instance.new("BillboardGui")
                            billboard.Name = "ESP"
                            billboard.Size = UDim2.new(0, 100, 0, 40)
                            billboard.StudsOffset = Vector3.new(0, 3, 0)
                            billboard.Adornee = player.Character.HumanoidRootPart
                            billboard.AlwaysOnTop = true
                            local label = Instance.new("TextLabel")
                            label.Size = UDim2.new(1, 0, 1, 0)
                            label.BackgroundTransparency = 1
                            label.TextColor3 = Color3.new(1, 0, 0)
                            label.Text = player.Name
                            label.Parent = billboard
                            billboard.Parent = player.Character
                        end
                    end
                end
            end)
        else
            RunService:UnbindFromRenderStep("PlayerESP")
            for _, player in ipairs(Players:GetPlayers()) do
                if player.Character and player.Character:FindFirstChild("ESP") then
                    player.Character:FindFirstChild("ESP"):Destroy()
                end
            end
        end
    end
})

Section4:Toggle({
    Text = "FPS Unlocker",
    Callback = function(state)
        if state and setfpscap then
            setfpscap(1000)
        elseif not state and setfpscap then
            setfpscap(60)
        end
    end
})

Section4:Toggle({
    Text = "Anti-Lag",
    Callback = function(state)
        if state then
            for _, obj in pairs(workspace:GetDescendants()) do
                if obj:IsA("Texture") or obj:IsA("Decal") then
                    obj.Transparency = 1
                elseif obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
                    obj:Destroy()
                end
            end
        end
    end
})

Section4:Toggle({
    Text = "Anti-Latency",
    Callback = function(state)
        if state then
            settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        end
    end
})

Section4:Toggle({
    Text = "Anti-Ping",
    Callback = function(state)
        if state then
            game:GetService("NetworkSettings").IncomingReplicationLag = 0
        end
    end
})

-- Game Status Paragraph
local statusText = Section5:Paragraph({
    Text = "Disaster: Unknown",
    Tooltip = "Current disaster in progress."
})

-- Real-time disaster status updater
spawn(function()
    while true do
        local disasterLabel = workspace:FindFirstChild("_Disaster")
        if disasterLabel and disasterLabel:IsA("StringValue") then
            statusText:Set({ Text = "Disaster: " .. disasterLabel.Value })
        else
            statusText:Set({ Text = "Disaster: Unknown" })
        end
        wait(1)
    end
end)
